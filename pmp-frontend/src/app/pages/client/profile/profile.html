<app-header></app-header>
<div class="profile-container">
  @if (isLoading()) {
    <div class="loading">
      <p>Loading profile...</p>
      <div class="spinner"></div>
    </div>
  } @else if (user()) {
    <!-- Profile Header -->
    <div class="profile-header">
      <div class="profile-avatar" [style.background]="getAvatarColor()">
        {{ user()!.name.charAt(0).toUpperCase() }}
      </div>
      <div class="profile-info">
        <h1>{{ user()!.name }}</h1>
        <p class="email">{{ user()!.email }}</p>
        @if (isOwnProfile()) {
          <div class="profile-actions">
            <button class="btn-edit-profile" (click)="toggleEditProfile()">
              <mat-icon>edit</mat-icon>
              <span>{{ isEditingProfile() ? 'Cancel' : 'Edit Profile' }}</span>
            </button>
            <button class="btn-new-post" (click)="createNewPost()">
              <mat-icon>add</mat-icon>
              <span>New Post</span>
            </button>
          </div>
        }
      </div>
    </div>

    <!-- Edit Profile Modal -->
    @if (isEditingProfile()) {
      <div class="modal-backdrop" (click)="toggleEditProfile()"></div>
      <div class="modal edit-profile-modal" [class.ng-animate]="isEditingProfile()">
        <div class="edit-modal-content">
          <div class="modal-header">
            <h2>Edit Profile</h2>
            <button class="close-btn" (click)="toggleEditProfile()" title="Close">âœ•</button>
          </div>
          <form (ngSubmit)="updateProfile()" class="edit-form">
            <div class="form-group">
              <label for="name">Name</label>
              <input
                id="name"
                type="text"
                [(ngModel)]="editFormData.name"
                name="name"
                placeholder="Your name"
                class="form-input"
                [class.error-border]="formErrors.name"
              />
              @if (formErrors.name) {
                <span class="error-message">{{ formErrors.name }}</span>
              }
            </div>

            <div class="form-group">
              <label for="email">Email</label>
              <input
                id="email"
                type="email"
                [(ngModel)]="editFormData.email"
                name="email"
                placeholder="Your email"
                class="form-input"
                [class.error-border]="formErrors.email"
              />
              @if (formErrors.email) {
                <span class="error-message">{{ formErrors.email }}</span>
              }
            </div>

            <div class="form-divider-section">
              <h3>Change Password (Optional)</h3>
            </div>

            <div class="form-group">
              <label for="newPassword">New Password</label>
              <input
                id="newPassword"
                type="password"
                [(ngModel)]="editFormData.newPassword"
                name="newPassword"
                placeholder="Enter new password"
                class="form-input"
                [class.error-border]="formErrors.newPassword"
              />
              @if (formErrors.newPassword) {
                <span class="error-message">{{ formErrors.newPassword }}</span>
              }
            </div>

            <div class="form-group">
              <label for="confirmPassword">Confirm Password</label>
              <input
                id="confirmPassword"
                type="password"
                [(ngModel)]="editFormData.confirmPassword"
                name="confirmPassword"
                placeholder="Confirm new password"
                class="form-input"
                [class.error-border]="formErrors.confirmPassword"
              />
              @if (formErrors.confirmPassword) {
                <span class="error-message">{{ formErrors.confirmPassword }}</span>
              }
            </div>

            <div class="modal-actions">
              <button type="button" class="cancel-btn" (click)="toggleEditProfile()">
                Cancel
              </button>
              <button type="submit" class="submit-btn">
                Save Changes
              </button>
            </div>
          </form>
        </div>
      </div>
    }

    <!-- User Posts Section -->
    <div class="posts-section">
      <h2>Posts by {{ user()!.name }}</h2>
      @if (posts().length === 0) {
        <div class="no-posts">
          <p>No posts yet</p>
        </div>
      } @else {
        <div class="posts-grid">
          @for (post of posts(); track post.id) {
            <app-post-card
              [post]="post"
              (editPost)="onEditPost($event)"
              (deletePost)="onDeletePost($event)">
            </app-post-card>
          }
        </div>
      }
    </div>

    <!-- Edit Post Modal -->
    @if (selectedPostToEdit()) {
      <div class="modal-backdrop" (click)="onPostEditingClosed()"></div>
      <div class="modal" [class.ng-animate]="selectedPostToEdit()" [class.is-updating]="isUpdatingPost()">
        <app-post-edit-modal
          [post]="selectedPostToEdit()!"
          (close)="onPostEditingClosed($event)">
        </app-post-edit-modal>
      </div>
    }
  }
</div>
<app-footer></app-footer>